/* 
 * SignalR State Manager
 * Released under Apache License
 * This plugin needs jQuery [http://www.jquery.com], just like SignalR.
 * Date: Thu Apr 16 2015 00:43:05 GMT+0600 (Bangladesh Standard Time)
 */
function signalrStateManager(e){"use strict";function t(){var t=$(e.recordTemplateSelector);$(t).hide(),$(t).addClass(f.templateDom),r(),e.signOutButtonSelector&&$(e.signOutButtonSelector).click(function(){sessionStorage.removeItem(f.storeKey)}),e.panelOpenerSelector&&e.panelSelector&&$(document).click(function(t){var n=$(t.target);n[0]==$(e.panelOpenerSelector)[0]?$(e.panelSelector).slideToggle("fast"):0==n.parents(e.panelSelector).length&&n[0]!=$(e.panelSelector)[0]&&"none"!=$(e.panelSelector).css("display")&&$(e.panelSelector).slideUp("fast")})}function n(){$.connection[e.signalrHubName].client[e.getNotifiedMethodName]=function(t){var n="string"==typeof t?JSON.parse(t):t;l(n,e.addAt);var o=c(n),r=null;r=e.addAt==f.addAt.bottom?$(o).appendTo($("."+f.templateDom).parent()):$(o).prependTo($("."+f.templateDom).parent()),e.itemRemoverSelector&&$(e.itemRemoverSelector).click(a),e.counterSelector&&i(1),"function"==typeof e.onNotificationArrival&&e.onNotificationArrival(n),"function"==typeof e.onDataRender&&e.onDataRender()},$.connection.hub.start().done(function(){"function"==typeof e.onSignalrInit&&e.onSignalrInit(),!e.getListMethodName||d.rendered||u(f.storeKey)||o()})}function o(){$.connection[e.signalrHubName].server[e.getListMethodName]().then(function(t){var n;n="string"==typeof t?JSON.parse(t):t,p(f.storeKey,t),r(),"function"==typeof e.onGetList&&e.onGetList(n)})}function r(){var t=u(f.storeKey);if(t){d.rendered=!0;for(var n,o=0;o<t.length;o++)n=c(t[o]),$(n).appendTo($("."+f.templateDom).parent());e.counterSelector&&i(t.length),"function"==typeof e.onDataRender&&e.onDataRender(),e.itemRemoverSelector&&$(e.itemRemoverSelector).click(a)}}function a(){var t=$(this).closest(e.recordTemplateSelector),n=$(e.panelSelector+" "+e.recordTemplateSelector).not("."+f.templateDom).index(t),o=m(n);t.fadeOut(function(){$(this).remove(),e.counterSelector&&i(-1)}),"function"==typeof e.onItemRemoval&&e.onItemRemoval(o)}function i(t){var n=$(e.counterSelector);if("INPUT"==n[0].tagName.toUpperCase()){var o=parseInt($(n).val());o||(o=0),$(n).val(o+t)}else{var o=parseInt($(n).html());o||(o=0),$(n).html(o+t)}}function l(e,t){var n=u(f.storeKey);n?t==f.addAt.bottom?n.push(e):n.unshift(e):n=[e],p(f.storeKey,n)}function c(t){var n=$("."+f.templateDom).clone();n.removeClass(f.templateDom),n.show();var o=n[0].outerHTML;for(var r in t){var a=t[r];e.dateTimeFieldName&&e.dateTimeFieldName==r&&(a=s(t[r],!1));var i=new RegExp("\\[\\["+r+"\\]\\]","gim");o=o.replace(i,a)}return o}function s(e,t){var n=new Date(e.indexOf("Date(")>=0?parseInt(e.slice(6,-2)):e+" GMT+0000"),o=new Date;return e=(n.getHours()%12||12)+":"+(n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes())+" "+(n.getHours()<12?"AM":"PM"),e=(n.toDateString()==o.toDateString()?"":n.toLocaleDateString()+(t?"<br/>":" "))+e}function p(e,t){if(sessionStorage){var n=null;if(t){var n,o;o="string"==typeof t?o=JSON.parse(t):t,n=escape(JSON.stringify(o))}sessionStorage.setItem(e,n)}}function u(e){if(sessionStorage){var t=null,n=sessionStorage.getItem(e);return n&&(t=JSON.parse(unescape(n))),t}}function m(e){if(0>e)return null;var t=u(f.storeKey),n=t.splice(e,1);return p(f.storeKey,t),n.length>0?n[0]:null}var f={pluginInit:new Date,templateDom:"signalNotificationDom",storeKey:"signalNotificationData",addAt:{top:"top",bottom:"bottom"}},d={rendered:!1};$(function(){t(),n()})}
