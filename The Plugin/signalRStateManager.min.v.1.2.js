/* 
 * SignalR State Manager
 * Released under Apache License
 * This plugin needs jQuery [http://www.jquery.com], just like SignalR.
 * Date: Thu Apr 16 2015 00:43:05 GMT+0600 (Bangladesh Standard Time)
 */
function signalrStateManager(e){"use strict";function t(){var t=$(e.recordTemplateSelector);$(t).hide(),$(t).addClass(p.dataDomClass),o(),e.signOutButtonSelector&&$(e.signOutButtonSelector).click(function(){sessionStorage.removeItem(p.storeKey)}),e.panelOpenerSelector&&e.panelSelector&&$(document).click(function(t){var n=$(t.target);n[0]==$(e.panelOpenerSelector)[0]?$(e.panelSelector).slideToggle("fast"):0==n.parents(e.panelSelector).length&&n[0]!=$(e.panelSelector)[0]&&"none"!=$(e.panelSelector).css("display")&&$(e.panelSelector).slideUp("fast")})}function n(){$.connection[e.signalrHubName].client[e.getNotifiedMethodName]=function(t){var n="string"==typeof t?JSON.parse(t):t;i(n,e.addAt);var a=s(n);e.addAt==p.addAt.bottom?$(a).appendTo($("."+p.dataDomClass).parent()):$(a).prependTo($("."+p.dataDomClass).parent()),e.counterSelector&&r(1),"function"==typeof e.onNotificationArrival&&e.onNotificationArrival(n)},$.connection.hub.start().done(function(){"function"==typeof e.onSignalrInit&&e.onSignalrInit(),!e.getListMethodName||d.rendered||u(p.storeKey)||a()})}function a(){$.connection[e.signalrHubName].server[e.getListMethodName]().then(function(t){var n;n="string"==typeof t?JSON.parse(t):t,c(p.storeKey,t),o(),"function"==typeof e.onGetList&&e.onGetList(n)})}function o(){var t=u(p.storeKey);if(t){d.rendered=!0;for(var n,a=0;a<t.length;a++)n=s(t[a]),$(n).appendTo($("."+p.dataDomClass).parent());e.counterSelector&&r(t.length)}}function r(t){var n=$(e.counterSelector);if("INPUT"==n[0].tagName.toUpperCase()){var a=parseInt($(n).val());a||(a=0),$(n).val(a+t)}else{var a=parseInt($(n).html());a||(a=0),$(n).html(a+t)}}function i(e,t){var n=u(p.storeKey);n&&(t==p.addAt.bottom?n.push(e):n.unshift(e)),c(p.storeKey,n)}function s(t){var n=$("."+p.dataDomClass).clone();n.removeClass(p.dataDomClass),n.show();var a=n[0].outerHTML;for(var o in t){var r=t[o];e.dateTimeFieldName&&e.dateTimeFieldName==o&&(r=l(t[o],!1));var i=new RegExp("\\[\\["+o+"\\]\\]","gim");a=a.replace(i,r)}return a}function l(e,t){var n=new Date(e.indexOf("Date(")>=0?parseInt(e.slice(6,-2)):e+" GMT+0000"),a=new Date;return e=(n.getHours()%12||12)+":"+(n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes())+" "+(n.getHours()<12?"AM":"PM"),e=(n.toDateString()==a.toDateString()?"":n.toLocaleDateString()+(t?"<br/>":" "))+e}function c(e,t){if(sessionStorage){var n=null;if(t){var n,a;a="string"==typeof t?a=JSON.parse(t):t,n=escape(JSON.stringify(a))}sessionStorage.setItem(e,n)}}function u(e){if(sessionStorage){var t=null,n=sessionStorage.getItem(e);return n&&(t=JSON.parse(unescape(n))),t}}var p={pluginInit:new Date,dataDomClass:"signalNotificationDom",storeKey:"signalNotificationData",addAt:{top:"top",bottom:"bottom"}},d={rendered:!1};$(function(){t(),n()})}
